<div class="container mt-4">
  <h1 class="mb-4">Posts</h1>

  <%= form_with url: posts_path, method: :get, local: true, class: "mb-4" do %>
    <div class="input-group">
      <input type="text" name="query" class="form-control"
             placeholder="Search posts..." value="<%= @query %>">
      <button class="btn btn-primary">Search</button>
    </div>
  <% end %>

  <% if current_user %>
    <%= link_to "New Post", new_post_path, class: "btn btn-success mb-3" %>
  <% end %>

  <table class="table table-striped table-hover">
    <thead class="table-dark">
    <tr>
      <th>Title</th>
      <th>Author</th>
      <th>Status</th>
      <th>Comments</th>
      <th></th>
    </tr>
    </thead>

    <tbody>
    <% @posts.each do |post| %>
     <% if current_user&.admin? || post.user == current_user || post.published %>
      <tr>
        <td><%= link_to post.title, post %></td>
        <td><%= post.user.name %></td>

        <td>
          <% if post.published %>
            <span class="badge bg-success">Published</span>
          <% else %>
            <span class="badge bg-secondary">Draft</span>
          <% end %>
        </td>

        <td><%= post.comments.count %></td>

        <td class="text-end">
          <%= link_to "Show", post, class: "btn btn-sm btn-primary" %>

          <% if current_user&.admin? || post.user == current_user %>
            <%= link_to "Edit", edit_post_path(post), class: "btn btn-sm btn-warning" %>

            <%= link_to "Delete", post_path(post),
                        data: { turbo_method: :delete, turbo_confirm: "Are you sure?" },
                        class: "btn btn-sm btn-danger ms-1" %>
          <% end %>
        </td>
      </tr>
     <% end %>
    <% end %>
    </tbody>
  </table>

  <div class="mt-3 d-flex justify-content-center">
    <%= will_paginate @posts %>
  </div>
</div>
